## 2. Gestión de Usuarios, Grupos, Roles y Permisos

La gestión de usuarios, grupos y permisos es uno de los pilares fundamentales en la administración de sistemas Linux. Permite controlar quién accede al sistema, qué acciones puede realizar y cómo se protegen los archivos y recursos. En entornos empresariales, mantener una estructura organizada de cuentas y permisos garantiza seguridad y trazabilidad.

---

### 2.1 Cuentas de Usuario

Cada usuario en Linux tiene un **identificador único (UID)**, un **directorio home**, un **intérprete de comandos (shell)** y puede pertenecer a uno o más grupos.

#### Crear un usuario

```bash
useradd juan
passwd juan
```

**Explicación:**

* `useradd juan`: crea una nueva cuenta de usuario llamada *juan* con su directorio home en `/home/juan` y asigna un UID único.
* `passwd juan`: asigna una contraseña a la cuenta.

**Verificar creación:**

```bash
id juan
```

Muestra el UID, GID y grupos asociados al usuario.

**Ejemplo práctico:**
Supongamos que se desea crear un usuario de soporte técnico que acceda al sistema mediante SSH:

```bash
useradd -m -s /bin/bash soporte
passwd soporte
```

* `-m`: crea el directorio home.
* `-s`: define la shell predeterminada.

#### Modificar un usuario

```bash
usermod -aG wheel juan
```

**Descripción:**
Agrega al usuario *juan* al grupo *wheel*, que normalmente tiene privilegios administrativos (sudo).

Otros parámetros comunes:

* `usermod -l nuevo_nombre antiguo_nombre`: cambia el nombre del usuario.
* `usermod -d /nuevo/home juan`: cambia el directorio personal.

#### Eliminar un usuario

```bash
userdel -r juan
```

**Finalidad:** elimina la cuenta y el directorio home asociado. El parámetro `-r` borra también el contenido del home.

---

### 2.2 Grupos

Los grupos permiten gestionar permisos de manera colectiva, asignando privilegios a varios usuarios al mismo tiempo.

#### Crear un grupo

```bash
groupadd soporte
```

Crea un grupo llamado *soporte* con un GID único.

#### Agregar usuario a un grupo

```bash
usermod -aG soporte juan
```

**Explicación:**
Agrega el usuario *juan* al grupo *soporte* sin quitarlo de otros grupos (gracias al parámetro `-a`).

#### Ver miembros del grupo

```bash
getent group soporte
```

**Resultado:**

```
soporte:x:1002:juan,maria
```

Muestra los usuarios pertenecientes al grupo.

#### Eliminar grupo

```bash
groupdel soporte
```

**Uso práctico:** cuando un equipo de trabajo ya no existe o sus miembros se reasignan.

---

### 2.3 Permisos de Archivos

Cada archivo o directorio en Linux tiene asociado un **propietario (usuario)**, un **grupo** y tres tipos de permisos: lectura (r), escritura (w) y ejecución (x).

#### Visualizar permisos

```bash
ls -l archivo.txt
```

**Ejemplo de salida:**

```
-rwxr-x--- 1 juan soporte 4096 Oct 10 10:00 archivo.txt
```

**Interpretación:**

* **rwx** → permisos del propietario (*juan*): lectura, escritura, ejecución.
* **r-x** → permisos del grupo (*soporte*): lectura y ejecución.
* **---** → otros usuarios: sin permisos.

#### Cambiar permisos

```bash
chmod 750 archivo.txt
```

**Significado:**

* Propietario: rwx (7)
* Grupo: r-x (5)
* Otros: sin permisos (0)

#### Cambiar propietario y grupo

```bash
chown juan:soporte archivo.txt
```

**Ejemplo:**
Asigna el usuario *juan* como propietario y el grupo *soporte* como grupo asociado.

#### Permisos especiales

1. **setuid (4)** → ejecuta el archivo con permisos del propietario.

   ```bash
   chmod 4755 script.sh
   ```

   **Ejemplo:** cuando un programa requiere permisos temporales de root.

2. **setgid (2)** → los nuevos archivos en el directorio heredan el grupo.

   ```bash
   chmod 2755 /srv/compartido
   ```

   **Ejemplo:** útil para carpetas compartidas entre usuarios del mismo grupo.

3. **sticky bit (1)** → solo el propietario puede eliminar archivos en un directorio.

   ```bash
   chmod 1777 /tmp
   ```

   **Ejemplo:** el directorio `/tmp` lo usa todo el sistema, pero ningún usuario puede borrar archivos ajenos.

---

### 2.4 ACLs Extendidas (Access Control Lists)

Las ACL permiten otorgar permisos más granulares que los tres niveles tradicionales (propietario, grupo, otros).

#### Asignar permisos adicionales

```bash
setfacl -m u:maria:rwx archivo.txt
```

**Descripción:**

* `-m`: modifica la ACL existente.
* `u:maria:rwx`: otorga a la usuaria *maria* permisos de lectura, escritura y ejecución sobre el archivo.

#### Consultar ACL de un archivo

```bash
getfacl archivo.txt
```

**Salida ejemplo:**

```
# file: archivo.txt
# owner: juan
# group: soporte
user::rwx
user:maria:rwx
group::r-x
mask::rwx
other::---
```

**Interpretación:** además de los permisos estándar, *maria* tiene permisos explícitos.

#### Eliminar ACLs

```bash
setfacl -b archivo.txt
```

**Finalidad:** borra todas las ACL asignadas al archivo.

#### Escenario práctico

Si un archivo pertenece al grupo *soporte* pero se necesita que *maria* (de otro grupo) lo edite sin cambiar propietarios:

```bash
setfacl -m u:maria:rw archivo.txt
```

Esto mantiene la seguridad grupal mientras se otorgan permisos puntuales.

---

### 2.5 sudoers

El archivo `/etc/sudoers` define qué usuarios o grupos pueden ejecutar comandos como superusuario.

#### Editar de forma segura

Siempre se debe usar `visudo` para editar:

```bash
visudo
```

**Motivo:** valida la sintaxis antes de guardar, evitando errores que podrían bloquear el acceso administrativo.

#### Ejemplo de configuración

```
juan ALL=(ALL) NOPASSWD: ALL
```

**Interpretación:**

* *juan* puede ejecutar cualquier comando como cualquier usuario o grupo.
* *NOPASSWD* evita que se solicite la contraseña cada vez que se usa `sudo`.

#### Configurar privilegios por grupo

```
%wheel ALL=(ALL) ALL
```

Todos los usuarios del grupo *wheel* tienen privilegios administrativos.

#### Ejemplo práctico

1. Crear usuario administrativo:

   ```bash
   useradd admin1
   passwd admin1
   usermod -aG wheel admin1
   ```
2. Verificar acceso:

   ```bash
   su - admin1
   sudo dnf update
   ```

   Si está correctamente configurado, el usuario podrá ejecutar tareas administrativas sin cambiar a root.

#### Seguridad recomendada

* No editar `/etc/sudoers` directamente sin `visudo`.
* Restringir comandos específicos:

  ```
  juan ALL=(ALL) /usr/bin/systemctl restart httpd
  ```

  Permite a *juan* reiniciar Apache pero no ejecutar otros comandos.

---

### Conclusión

La correcta administración de usuarios, grupos y permisos garantiza un sistema seguro y ordenado. El uso de ACLs y sudoers permite aplicar políticas flexibles sin comprometer la seguridad. Estas prácticas son esenciales en entornos corporativos donde varios administradores y usuarios interactúan con el mismo servidor.
