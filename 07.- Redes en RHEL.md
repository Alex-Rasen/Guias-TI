##  7: Redes en RHEL

### 7.1 Conceptos Fundamentales

El subsistema de red en Linux permite configurar interfaces, enrutamiento, DNS, servicios y cortafuegos. En Red Hat, la herramienta principal para la gestión de red moderna es **NetworkManager**, que puede manejarse con `nmcli` o `nmtui`.

**Archivos relevantes:**

* `/etc/sysconfig/network-scripts/` → configuración tradicional (RHEL 7)
* `/etc/NetworkManager/system-connections/` → configuraciones actuales (RHEL 8/9)
* `/etc/resolv.conf` → servidores DNS
* `/etc/hosts` → resolución local de nombres

---

### 7.2 Visualización del estado de red

| Comando                 | Finalidad                                           | Ejemplo práctico                                                             |                                                          |
| ----------------------- | --------------------------------------------------- | ---------------------------------------------------------------------------- | -------------------------------------------------------- |
| `ip a`                  | Muestra interfaces de red, direcciones IP y estado. | `ip a show eth0` → Muestra solo la interfaz `eth0`.                          |                                                          |
| `nmcli device status`   | Lista dispositivos detectados por NetworkManager.   | `nmcli device status` → Verifica si una interfaz está conectada.             |                                                          |
| `nmcli connection show` | Lista conexiones configuradas.                      | `nmcli connection show` → Muestra los perfiles de red activos y almacenados. |                                                          |
| `ping`                  | Comprueba conectividad ICMP.                        | `ping -c 4 8.8.8.8` → Prueba conexión con servidor DNS público de Google.    |                                                          |
| `traceroute`            | Muestra la ruta de red hacia un destino.            | `traceroute www.redhat.com`                                                  |                                                          |
| `ss -tulpn`             | Lista puertos en uso y servicios asociados.         | `ss -tulpn                                                                   | grep ssh` → Verifica si el servicio SSH está escuchando. |

---

### 7.3 Configuración de una interfaz de red (nmcli)

#### Crear una nueva conexión manual

```bash
nmcli con add type ethernet ifname eth0 con-name LAN ipv4.addresses 192.168.10.10/24 ipv4.gateway 192.168.10.1 ipv4.dns 8.8.8.8 ipv4.method manual
```

**Descripción:**

* Crea una conexión llamada `LAN` en la interfaz `eth0`.
* Asigna dirección IP estática `192.168.10.10/24` y gateway `192.168.10.1`.

#### Activar la conexión

```bash
nmcli con up LAN
```

#### Editar una conexión existente

```bash
nmcli con mod LAN ipv4.dns "1.1.1.1 8.8.8.8"
```

#### Cambiar hostname del sistema

```bash
hostnamectl set-hostname servidor-red.local
```

* Modifica el nombre de host persistente del sistema.

---

### 7.4 Configuración de red mediante archivo

**Ejemplo (RHEL 7 / sistema clásico):**
Archivo: `/etc/sysconfig/network-scripts/ifcfg-eth0`

```
DEVICE=eth0
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.1.100
PREFIX=24
GATEWAY=192.168.1.1
DNS1=8.8.8.8
```

Reiniciar red:

```bash
systemctl restart NetworkManager
```

---

### 7.5 Configuración de DNS

Editar `/etc/resolv.conf`:

```
nameserver 8.8.8.8
nameserver 1.1.1.1
```

Comando para probar resolución:

```bash
dig redhat.com
nslookup google.com
```

---

### 7.6 Firewall con `firewalld`

`firewalld` administra reglas dinámicas de red en zonas (public, internal, trusted, etc.).

#### Comandos principales

```bash
firewall-cmd --get-active-zones
firewall-cmd --zone=public --add-service=http --permanent
firewall-cmd --reload
```

**Ejemplo práctico: habilitar SSH y HTTP**

```bash
firewall-cmd --zone=public --add-service=ssh --permanent
firewall-cmd --zone=public --add-service=http --permanent
firewall-cmd --reload
```

#### Ver reglas activas

```bash
firewall-cmd --list-all
```

#### Agregar puerto específico

```bash
firewall-cmd --add-port=8080/tcp --permanent
```

---

### 7.7 Diagnóstico avanzado

| Comando                   | Descripción                                                                |
| ------------------------- | -------------------------------------------------------------------------- |
| `tcpdump -i eth0 port 22` | Captura paquetes de red en tiempo real (útil para depurar conexiones SSH). |
| `ethtool eth0`            | Muestra estadísticas de la interfaz de red y su velocidad.                 |
| `mtr google.com`          | Combina ping y traceroute para analizar latencia y pérdida de paquetes.    |

---

### 7.8 Configuración de rutas estáticas

**Finalidad:** agregar rutas personalizadas a redes remotas.

```bash
nmcli connection modify LAN +ipv4.routes "10.0.0.0/24 192.168.10.1"
nmcli connection up LAN
```

* Crea una ruta para alcanzar la red `10.0.0.0/24` usando `192.168.10.1` como gateway.

**Ver tabla de enrutamiento:**

```bash
ip route show
```

---

### 7.9 VLANs y Puentes

**Crear una VLAN ID 20 en eth0:**

```bash
nmcli con add type vlan con-name VLAN20 dev eth0 id 20 ipv4.addresses 192.168.20.10/24 ipv4.method manual
```

**Crear un puente (bridge):**

```bash
nmcli con add type bridge con-name br0 ifname br0
nmcli con add type ethernet slave-type bridge con-name br0-port ifname eth0 master br0
```

---

### 7.10 Prueba completa de red

1. Configurar IP estática.
2. Probar conectividad local (`ping gateway`).
3. Probar salida a Internet (`ping 8.8.8.8`).
4. Verificar DNS (`dig redhat.com`).
5. Comprobar reglas del firewall (`firewall-cmd --list-all`).
