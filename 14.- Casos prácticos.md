
## 14. Casos Prácticos / Laboratorios Integrados

### 14.1 Despliegue Inicial

**Objetivo:** preparar un servidor RHEL desde cero.

Pasos:

1. Instalar RHEL versión minimal para reducir superficie de ataque.
2. Configurar red con `nmcli`.
3. Establecer hostname y repositorios.
4. Crear usuarios administrativos:

```bash
useradd admin1
passwd admin1
usermod -aG wheel admin1
```

5. Habilitar acceso SSH seguro y probar conexión.

---

### 14.2 Configurar un Servidor Web con Ansible

**Objetivo:** automatizar instalación y configuración de Apache.

```yaml
- hosts: web
  become: yes
  tasks:
    - name: Instalar Apache
      dnf:
        name: httpd
        state: present

    - name: Copiar página principal
      copy:
        src: index.html
        dest: /var/www/html/index.html

    - name: Iniciar y habilitar servicio
      service:
        name: httpd
        state: started
        enabled: yes
```

**Ejecución:**

```bash
ansible-playbook webserver.yml
```

**Resultado:** despliega un servidor web funcional con una sola ejecución.

---

### 14.3 Backup y Restauración de Configuración

**Objetivo:** asegurar la recuperación rápida ante fallos.**

#### Crear copia de seguridad

```bash
tar -czf /backup/configs_$(date +%F).tar.gz /etc/
```

#### Restaurar configuración

```bash
tar -xzf /backup/configs_2025-10-11.tar.gz -C /
```

**Ejemplo práctico:** después de modificar `sshd_config`, si ocurre un error, se puede restaurar la versión anterior.

---

### 14.4 Monitoreo Automatizado

**Objetivo:** enviar alertas automáticas cuando la CPU supere el 90%.

#### Crear script de alerta

```bash
#!/bin/bash
cpu_usage=$(top -bn1 | grep "Cpu(s)" | awk '{print $2 + $4}')
if (( ${cpu_usage%.*} > 90 )); then
  echo "Alerta: CPU al ${cpu_usage}%" | mail -s "Alerta CPU" admin@empresa.cl
fi
```

Guardar como `/usr/local/bin/alerta_cpu.sh` y darle permisos de ejecución:

```bash
chmod +x /usr/local/bin/alerta_cpu.sh
```

#### Programar con cron

```bash
*/5 * * * * /usr/local/bin/alerta_cpu.sh
```

**Explicación:** ejecuta el script cada 5 minutos para evaluar el consumo de CPU.

---

## Conclusión

Estos capítulos integran las habilidades de monitoreo, seguridad, respaldo y automatización necesarias para operar un entorno Red Hat estable y seguro. La práctica constante de cada herramienta y comando refuerza la capacidad de respuesta ante incidentes y la eficiencia en la administración del sistema.
