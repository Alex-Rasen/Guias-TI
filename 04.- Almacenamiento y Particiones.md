## 4: Almacenamiento y Particiones

### 4.1 Particionado de discos

**Finalidad:** Preparar discos nuevos o reorganizar los existentes para asignar espacio a particiones.

#### Ver discos disponibles

```bash
lsblk
```

* Muestra la estructura de discos, particiones y puntos de montaje.

#### Crear partición con `fdisk`

```bash
fdisk /dev/sdb
```

1. Presiona `n` para nueva partición.
2. Elige primaria.
3. Define el tamaño (por ejemplo, `+10G`).
4. Guarda con `w`.

#### Crear con `parted`

```bash
parted /dev/sdb mklabel gpt
parted /dev/sdb mkpart primary ext4 1MiB 10GiB
```

* **GPT:** esquema moderno que reemplaza MBR, soporta discos grandes.
* **mkpart:** define tipo, sistema de archivos y tamaño.

---

### 4.2 Formateo de particiones

**Finalidad:** Aplicar un sistema de archivos (ext4, xfs, btrfs) a una partición antes de montarla.

```bash
mkfs.ext4 /dev/sdb1
```

* Crea un sistema de archivos ext4.

```bash
mkfs.xfs /dev/sdb2
```

* Ideal para entornos Red Hat modernos, por su rendimiento en volúmenes grandes.

Ejemplo de montaje:

```bash
mount /dev/sdb1 /mnt/datos
```

---

### 4.3 Aumentar tamaño de una partición existente (LVM)

#### Verificar espacio libre en el VG

```bash
vgs
```

#### Extender el LV

```bash
lvextend -r -L +5G /dev/vg_datos/lv_backup
```

* `-r` ajusta el sistema de archivos automáticamente.
* Este comando **aumenta la capacidad** de un volumen lógico en 5 GB sin necesidad de desmontarlo.

#### Confirmar el nuevo tamaño

```bash
df -h /mnt/backup
```

---

### 4.4 Cifrado de discos con LUKS

**Finalidad:** Proteger datos sensibles mediante cifrado a nivel de bloque.

```bash
cryptsetup luksFormat /dev/sdb1
cryptsetup open /dev/sdb1 secure_disk
mkfs.ext4 /dev/mapper/secure_disk
mount /dev/mapper/secure_disk /mnt/secure
```

* **luksFormat:** inicializa la partición con cifrado.
* **open:** desbloquea y asigna un alias lógico (`/dev/mapper/secure_disk`).

Al reiniciar, el sistema pedirá la contraseña para montar el volumen.

---

### 4.5 Snapshots en LVM

**Finalidad:** Crear copias instantáneas de un volumen para respaldo o pruebas.

```bash
lvcreate -L1G -s -n snap_backup /dev/vg_datos/lv_backup
```

* **-s:** indica que es snapshot.
* **-L1G:** reserva 1 GB para almacenar cambios.

Restaurar desde snapshot:

```bash
lvconvert --merge /dev/vg_datos/snap_backup
```

---

### 4.6 Expansión de almacenamiento físico

**Escenario:** Agregar un nuevo disco `/dev/sdc` al grupo existente.

```bash
pvcreate /dev/sdc
vgextend vg_datos /dev/sdc
lvextend -L +10G /dev/vg_datos/lv_backup
xfs_growfs /mnt/backup
```

* Permite ampliar la capacidad total del grupo y los volúmenes lógicos sin reiniciar.

---

### 4.7 Comprobación y reparación de sistemas de archivos

**Finalidad:** Verificar la integridad de las particiones y reparar errores.

```bash
e2fsck -f /dev/sdb1
```

* Escanea y corrige errores del sistema de archivos ext4.

Para XFS:

```bash
xfs_repair /dev/sdb1
```
