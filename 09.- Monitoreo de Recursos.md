## 9. Monitoreo de Recursos

### 9.1 Comandos de Diagnóstico

El monitoreo de recursos en Linux permite evaluar el rendimiento general del sistema y detectar cuellos de botella en CPU, memoria, disco o red. A continuación se detallan los comandos más utilizados y su finalidad.

#### top

Muestra en tiempo real los procesos activos, su consumo de CPU, memoria y prioridad.

```bash
top
```

**Uso práctico:** identificar procesos que consumen excesivamente CPU. En la parte superior se observa el porcentaje de uso por núcleo y memoria.

#### htop

Herramienta mejorada de `top` con interfaz interactiva y navegación por teclado.

```bash
htop
```

**Uso práctico:** permite detener procesos directamente (F9) o filtrar por nombre.

#### vmstat 2

Muestra estadísticas del sistema: procesos, memoria, intercambio, E/S, CPU. El número `2` indica que actualiza cada 2 segundos.

```bash
vmstat 2
```

**Ejemplo:** útil para ver actividad del sistema durante pruebas de carga.

#### iostat -x 2

Muestra el rendimiento de dispositivos de almacenamiento.

```bash
iostat -x 2
```

**Interpretación:** los campos `r/s`, `w/s` indican lecturas/escrituras por segundo. `util` muestra porcentaje de uso del disco.

#### sar -u 2 5

Muestra el uso de CPU promedio cada 2 segundos durante 5 iteraciones.

```bash
sar -u 2 5
```

**Finalidad:** obtener una muestra representativa de carga en distintos momentos.

#### free -h

Muestra el uso de memoria RAM y swap en formato legible.

```bash
free -h
```

**Interpretación:** el valor “available” indica la memoria libre realmente utilizable por procesos.

#### df -h

Reporta el espacio ocupado y disponible en cada sistema de archivos montado.

```bash
df -h
```

**Uso común:** verificar particiones llenas, especialmente `/var` y `/home`.

#### du -sh /var/log

Calcula el tamaño total de un directorio.

```bash
du -sh /var/log
```

**Ejemplo práctico:** detectar crecimiento inusual de logs que podría llenar el disco.

---

### 9.2 Logs y Seguimiento

Los registros del sistema son esenciales para diagnosticar problemas y auditar actividades.

#### tail -f /var/log/messages

Muestra en tiempo real las últimas líneas del archivo de log principal del sistema.

```bash
tail -f /var/log/messages
```

**Uso:** útil para ver eventos mientras se reinicia un servicio o se conecta un dispositivo.

#### journalctl -f

Visualiza los registros gestionados por `systemd` en tiempo real.

```bash
journalctl -f
```

**Ejemplo:**

```bash
journalctl -u sshd -f
```

Permite seguir solo los eventos del servicio SSH.

---

### 9.3 Monitoreo Avanzado

Para un monitoreo más completo del sistema se pueden instalar y configurar herramientas adicionales.

#### Instalación de utilidades

```bash
dnf install net-tools sysstat nmon -y
```

* **net-tools:** incluye comandos clásicos como `ifconfig`, `netstat`.
* **sysstat:** proporciona herramientas como `sar`, `iostat` y `mpstat`.
* **nmon:** interfaz interactiva para monitorear CPU, memoria, red y disco.

#### Ejemplo: Monitorear CPU y memoria con nmon

```bash
nmon
```

Presionar:

* `c` para CPU.
* `m` para memoria.
* `d` para discos.

#### Integración con Zabbix o Prometheus

* **Zabbix:** se instala un agente (`zabbix-agent`) que envía métricas a un servidor central.
* **Prometheus:** recolecta datos a través de *exporters*, por ejemplo `node_exporter`.

**Ejemplo instalación Prometheus Node Exporter:**

```bash
useradd -rs /bin/false node_exporter
wget https://github.com/prometheus/node_exporter/releases/download/v1.8.0/node_exporter-1.8.0.linux-amd64.tar.gz
tar -xvf node_exporter-1.8.0.linux-amd64.tar.gz
mv node_exporter-1.8.0.linux-amd64/node_exporter /usr/local/bin/
```

Crear servicio systemd:

```bash
vim /etc/systemd/system/node_exporter.service
```

```
[Unit]
Description=Prometheus Node Exporter
After=network.target

[Service]
User=node_exporter
ExecStart=/usr/local/bin/node_exporter

[Install]
WantedBy=default.target
```

Iniciar servicio:

```bash
systemctl enable node_exporter
systemctl start node_exporter
```

Acceder desde Prometheus: `http://servidor:9100/metrics`

