## 3: Gestión de Archivos y Sistemas de Ficheros

### 3.1 Comandos básicos de manejo de archivos

| Comando  | Finalidad                                                             | Ejemplo práctico                                                                         |
| -------- | --------------------------------------------------------------------- | ---------------------------------------------------------------------------------------- |
| `ls`     | Lista el contenido de un directorio. Permite ver archivos y permisos. | `ls -l /etc` → Muestra los archivos del directorio `/etc` en formato detallado.          |
| `cp`     | Copia archivos o directorios.                                         | `cp /etc/fstab /tmp/fstab.bak` → Crea una copia de seguridad del archivo `fstab`.        |
| `mv`     | Mueve o renombra archivos.                                            | `mv /tmp/fstab.bak /root/fstab.bak` → Mueve el archivo al directorio `/root`.            |
| `rm`     | Elimina archivos o directorios.                                       | `rm -rf /tmp/logs/` → Borra recursivamente una carpeta.                                  |
| `find`   | Busca archivos por nombre, tamaño o fecha.                            | `find /var/log -name "*.log"` → Encuentra todos los archivos `.log`.                     |
| `locate` | Busca archivos indexados rápidamente.                                 | `locate httpd.conf` → Encuentra la ubicación del archivo de configuración de Apache.     |
| `tar`    | Comprime o descomprime archivos en formato TAR.                       | `tar -czvf backup.tar.gz /etc/` → Crea un archivo comprimido con el contenido de `/etc`. |
| `grep`   | Busca texto dentro de archivos.                                       | `grep 'PermitRootLogin' /etc/ssh/sshd_config` → Busca la línea con esa configuración.    |
| `du`     | Muestra el uso de disco de archivos o carpetas.                       | `du -sh /var/log` → Muestra el tamaño total de la carpeta `/var/log`.                    |
| `df`     | Muestra el uso del sistema de archivos montado.                       | `df -h` → Lista el uso de disco en todas las particiones montadas.                       |

---

### 3.2 Montaje de sistemas de archivos

**Finalidad:** Permite acceder a discos o particiones conectadas al sistema asignándoles un punto de montaje.

```bash
mount /dev/sdb1 /mnt/datos
```

* **Descripción:** Monta la partición `/dev/sdb1` en el directorio `/mnt/datos`.
* **Uso típico:** Montar discos externos o particiones recién creadas.

**Desmontar un disco:**

```bash
umount /mnt/datos
```

* **Finalidad:** Libera la partición del sistema.

**Montaje permanente:**
Agregar línea en `/etc/fstab`:

```
/dev/sdb1 /mnt/datos ext4 defaults 0 0
```

* Permite que el disco se monte automáticamente en cada inicio del sistema.

---

### 3.3 Administración de LVM (Logical Volume Manager)

**Finalidad:** Permite crear volúmenes lógicos dinámicos que se pueden redimensionar sin afectar los datos.

#### Crear volúmenes lógicos

```bash
pvcreate /dev/sdb
vgcreate vg_datos /dev/sdb
lvcreate -L 10G -n lv_backup vg_datos
mkfs.xfs /dev/vg_datos/lv_backup
mount /dev/vg_datos/lv_backup /mnt/backup
```

* **pvcreate:** inicializa el disco físico como parte de LVM.
* **vgcreate:** crea un grupo de volúmenes llamado `vg_datos`.
* **lvcreate:** genera un volumen lógico de 10 GB.
* **mkfs.xfs:** formatea el volumen con sistema de archivos XFS.
* **mount:** monta el volumen para su uso.

#### Aumentar tamaño de un volumen lógico

```bash
lvextend -L +5G /dev/vg_datos/lv_backup
xfs_growfs /mnt/backup
```

* **Finalidad:** Aumenta la capacidad de la partición sin desmontarla.
* **Ejemplo:** útil para servidores de bases de datos o almacenamiento que crecen con el tiempo.

---

### 3.4 RAID por software con `mdadm`

**Finalidad:** Combinar varios discos físicos para mejorar redundancia o rendimiento.

```bash
mdadm --create /dev/md0 --level=1 --raid-devices=2 /dev/sdb /dev/sdc
mkfs.ext4 /dev/md0
mount /dev/md0 /mnt/raid1
```

* **RAID 1 (mirroring):** Duplica datos entre discos para tolerancia a fallos.
* **RAID 0 (striping):** Divide datos para mayor velocidad (sin redundancia).

**Ver estado del RAID:**

```bash
cat /proc/mdstat
```

---

### 3.5 Cuotas de disco

**Finalidad:** Limita el uso de espacio por usuario o grupo.

Habilitar cuotas en `/etc/fstab`:

```
/dev/sda1 /home ext4 defaults,usrquota,grpquota 0 0
```

Activar cuotas:

```bash
mount -o remount /home
quotacheck -avug
quotaon -v /home
setquota -u juan 500M 600M 0 0 /home
```

* **setquota:** asigna límites de 500 MB duros y 600 MB blandos al usuario *juan*.

Consultar uso:

```bash
repquota /home
```
