# 9. Monitoreo de Recursos

El monitoreo de recursos en Linux es esencial para evaluar el rendimiento general del sistema, detectar cuellos de botella y anticipar problemas de capacidad. RHEL proporciona diversas herramientas integradas y de terceros para supervisar CPU, memoria, disco, red y procesos.

---

## 9.1 Comandos de Diagnóstico

### top

Muestra en tiempo real los procesos activos y su consumo de CPU, memoria y prioridad.

```bash
top
```

**Uso práctico:** identificar procesos que consumen excesivamente CPU. Permite observar el uso por núcleo y la carga promedio del sistema.

**Atajos útiles dentro de `top`:**

* `P`: ordenar por uso de CPU.
* `M`: ordenar por uso de memoria.
* `k`: finalizar un proceso.
* `1`: mostrar núcleos individuales de CPU.

---

### htop

Herramienta mejorada de `top` con interfaz interactiva, colores y soporte para teclado.

```bash
htop
```

**Ventajas:**

* Permite filtrar procesos (`F3`) y finalizarlos (`F9`).
* Muestra de forma visual la carga de CPU y memoria.
* Ideal para entornos de administración rápida.

---

### vmstat 2

Muestra estadísticas generales del sistema cada 2 segundos.

```bash
vmstat 2
```

**Campos relevantes:**

* `r`: procesos en ejecución.
* `si/so`: actividad de swap (entrada/salida).
* `us/sy/id`: porcentaje de CPU en modo usuario, sistema e inactivo.

**Uso:** detectar saturación de CPU o memoria durante pruebas de carga.

---

### iostat -x 2

Muestra rendimiento de los dispositivos de almacenamiento.

```bash
iostat -x 2
```

**Interpretación:**

* `r/s`, `w/s`: lecturas y escrituras por segundo.
* `%util`: porcentaje de tiempo ocupado del dispositivo.

**Uso:** determinar si un disco está sobrecargado o presenta latencia alta.

---

### sar -u 2 5

Reporta el uso promedio de CPU cada 2 segundos durante 5 iteraciones.

```bash
sar -u 2 5
```

**Finalidad:** obtener tendencias de consumo de CPU en intervalos de tiempo.

**Requiere:** paquete `sysstat`.

---

### free -h

Muestra el uso de memoria RAM y swap en formato legible.

```bash
free -h
```

**Interpretación:** el valor `available` refleja la memoria realmente disponible para procesos.

---

### df -h

Reporta el uso del sistema de archivos.

```bash
df -h
```

**Uso común:** identificar particiones con poco espacio disponible (especialmente `/var`, `/home` y `/tmp`).

---

### du -sh /var/log

Calcula el tamaño total de un directorio.

```bash
du -sh /var/log
```

**Aplicación:** detectar crecimiento inusual de logs que podría llenar el disco.

---

## 9.2 Logs y Seguimiento

Los registros del sistema son esenciales para el diagnóstico y la auditoría de actividades.

### tail -f /var/log/messages

Muestra en tiempo real las últimas líneas del archivo de log principal.

```bash
tail -f /var/log/messages
```

**Uso:** observar eventos mientras se ejecutan acciones del sistema (reinicio de servicios, detección de dispositivos, errores del kernel).

---

### journalctl -f

Muestra logs en tiempo real gestionados por `systemd`.

```bash
journalctl -f
```

**Ejemplo:**

```bash
journalctl -u sshd -f
```

Filtra los eventos del servicio SSH en tiempo real.

**Opciones adicionales:**

* `-b`: mostrar logs del último arranque.
* `--since today`: logs del día actual.
* `-p err`: solo errores.

---

## 9.3 Monitoreo Avanzado

Para análisis continuo y en tiempo real, se pueden instalar herramientas adicionales.

### Instalación de utilidades complementarias

```bash
dnf install net-tools sysstat nmon -y
```

**Descripción:**

* **net-tools:** incluye utilidades clásicas (`ifconfig`, `netstat`).
* **sysstat:** provee `sar`, `iostat`, `mpstat`.
* **nmon:** herramienta interactiva para monitoreo integral.

---

### Ejemplo: Monitorear CPU y Memoria con nmon

```bash
nmon
```

**Combinaciones útiles:**

* `c`: CPU.
* `m`: memoria.
* `d`: discos.
* `n`: red.
* `q`: salir.

**Ventaja:** vista consolidada en tiempo real de múltiples recursos.

---

### Integración con Plataformas de Monitoreo

#### Zabbix

Sistema cliente-servidor donde el agente (`zabbix-agent`) recopila métricas del sistema y las envía a un servidor central.

Instalación básica del agente:

```bash
dnf install zabbix-agent -y
systemctl enable zabbix-agent
systemctl start zabbix-agent
```

Configurar `/etc/zabbix/zabbix_agentd.conf`:

```
Server=192.168.10.100
Hostname=servidor01
```

#### Prometheus

Recolecta métricas mediante *exporters*.

**Ejemplo: Node Exporter**

```bash
useradd -rs /bin/false node_exporter
wget https://github.com/prometheus/node_exporter/releases/download/v1.8.0/node_exporter-1.8.0.linux-amd64.tar.gz
tar -xvf node_exporter-1.8.0.linux-amd64.tar.gz
mv node_exporter-1.8.0.linux-amd64/node_exporter /usr/local/bin/
```

**Crear servicio systemd:**

```
[Unit]
Description=Prometheus Node Exporter
After=network.target

[Service]
User=node_exporter
ExecStart=/usr/local/bin/node_exporter

[Install]
WantedBy=default.target
```

**Habilitar servicio:**

```bash
systemctl enable node_exporter
systemctl start node_exporter
```

**Acceso:**
`http://<servidor>:9100/metrics`

**Uso:** Prometheus recolecta las métricas y Grafana las representa gráficamente.

---

## 9.4 Buenas Prácticas de Monitoreo

* Configurar alertas automáticas para CPU, memoria y disco (Zabbix, Prometheus, Nagios).
* Revisar logs del sistema periódicamente (`/var/log/messages`, `journalctl`).
* Implementar rotación de logs con `logrotate`.
* Monitorear el espacio en `/var` y `/tmp` para evitar caídas de servicios.
* Integrar monitoreo de red (`iftop`, `nload`, `ip -s link`) para detectar saturación de ancho de banda.
* Documentar umbrales de rendimiento y tendencias para planificación de capacidad.

---

### Glosario

* **CPU Load Average:** promedio de procesos en espera de CPU.
* **IOPS:** operaciones de entrada/salida por segundo.
* **Throughput:** cantidad de datos procesados por unidad de tiempo.
* **Exporter:** agente que expone métricas a Prometheus.
* **Alerting:** sistema de avisos ante condiciones anómalas.

---

### Referencias

* Red Hat Enterprise Linux 9 Monitoring Guide
  [https://access.redhat.com/documentation/en-us/](https://access.redhat.com/documentation/en-us/)
* Sysstat & SAR Manual: [https://linux.die.net/man/1/sar](https://linux.die.net/man/1/sar)
* Prometheus Node Exporter: [https://prometheus.io/docs/](https://prometheus.io/docs/)
