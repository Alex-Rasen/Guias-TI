# 7. Redes en RHEL

La administración de red en Red Hat Enterprise Linux (RHEL) es fundamental para garantizar conectividad, seguridad y estabilidad en entornos corporativos. A partir de RHEL 8, la gestión se centra en **NetworkManager**, aunque las configuraciones clásicas aún son compatibles.

---

## 7.1 Conceptos Fundamentales

El subsistema de red en Linux permite configurar interfaces, enrutamiento, DNS, servicios y cortafuegos. En RHEL, la herramienta principal es **NetworkManager**, manejable por línea de comandos (`nmcli`), interfaz de texto (`nmtui`) o gráficamente (`nm-connection-editor`).

**Archivos relevantes:**

| Ruta                                      | Propósito                                        |
| ----------------------------------------- | ------------------------------------------------ |
| `/etc/sysconfig/network-scripts/`         | Configuración tradicional (RHEL 7 y anteriores). |
| `/etc/NetworkManager/system-connections/` | Configuración actual (RHEL 8/9).                 |
| `/etc/resolv.conf`                        | Definición de servidores DNS.                    |
| `/etc/hosts`                              | Resolución local de nombres.                     |

**NetworkManager** abstrae los detalles del hardware y permite administrar conexiones Ethernet, Wi-Fi, VPN, VLANs y puentes de red con facilidad.

---

## 7.2 Visualización del Estado de Red

| Comando                 | Finalidad                                           | Ejemplo                     |           |
| ----------------------- | --------------------------------------------------- | --------------------------- | --------- |
| `ip a`                  | Muestra interfaces de red, direcciones IP y estado. | `ip a show eth0`            |           |
| `nmcli device status`   | Lista dispositivos detectados por NetworkManager.   | `nmcli device status`       |           |
| `nmcli connection show` | Lista conexiones configuradas y almacenadas.        | `nmcli connection show`     |           |
| `ping`                  | Verifica conectividad ICMP.                         | `ping -c 4 8.8.8.8`         |           |
| `traceroute`            | Muestra la ruta hasta un destino.                   | `traceroute www.redhat.com` |           |
| `ss -tulpn`             | Lista puertos y servicios asociados.                | `ss -tulpn                  | grep ssh` |

**Ejemplo práctico:**

```bash
nmcli device status
ip route show
ss -tulwn
```

Permite validar conectividad, rutas activas y puertos escuchando en el sistema.

---

## 7.3 Configuración de una Interfaz de Red (nmcli)

### Crear una conexión manual estática

```bash
nmcli con add type ethernet ifname eth0 con-name LAN ipv4.addresses 192.168.10.10/24 ipv4.gateway 192.168.10.1 ipv4.dns 8.8.8.8 ipv4.method manual
```

**Explicación:**

* Crea una conexión `LAN` asociada a `eth0`.
* Define IP estática `192.168.10.10/24`, gateway `192.168.10.1` y DNS `8.8.8.8`.

### Activar y modificar conexión

```bash
nmcli con up LAN
nmcli con mod LAN ipv4.dns "1.1.1.1 8.8.8.8"
```

### Cambiar hostname

```bash
hostnamectl set-hostname servidor-red.local
```

**Resultado:** cambia el nombre del host de forma persistente en `/etc/hostname`.

---

## 7.4 Configuración de Red mediante Archivo

**Ejemplo clásico (RHEL 7):**
Archivo: `/etc/sysconfig/network-scripts/ifcfg-eth0`

```
DEVICE=eth0
BOOTPROTO=static
ONBOOT=yes
IPADDR=192.168.1.100
PREFIX=24
GATEWAY=192.168.1.1
DNS1=8.8.8.8
```

**Aplicar cambios:**

```bash
systemctl restart NetworkManager
```

**Compatibilidad:** este método sigue siendo útil en entornos automatizados o imágenes de sistema personalizadas.

---

## 7.5 Configuración de DNS

Editar manualmente `/etc/resolv.conf`:

```
nameserver 8.8.8.8
nameserver 1.1.1.1
```

**Probar resolución DNS:**

```bash
dig redhat.com
nslookup google.com
```

**Consejo:** NetworkManager gestiona este archivo automáticamente; para fijar DNS permanentes, configúralos en la conexión (`nmcli con mod LAN ipv4.dns`).

---

## 7.6 Firewall con firewalld

`firewalld` gestiona reglas de red mediante **zonas** (public, internal, trusted, etc.) y soporta cambios dinámicos sin reiniciar.

### Comandos Principales

```bash
firewall-cmd --get-active-zones
firewall-cmd --zone=public --add-service=http --permanent
firewall-cmd --reload
```

### Ejemplo: habilitar SSH y HTTP

```bash
firewall-cmd --zone=public --add-service=ssh --permanent
firewall-cmd --zone=public --add-service=http --permanent
firewall-cmd --reload
```

### Ver reglas activas

```bash
firewall-cmd --list-all
```

### Agregar puerto específico

```bash
firewall-cmd --add-port=8080/tcp --permanent
```

**Verificación:**

```bash
ss -tuln | grep 8080
```

**Zonas recomendadas:**

* `public`: conexiones externas seguras.
* `internal`: red local confiable.
* `trusted`: sin filtrado.

---

## 7.7 Diagnóstico Avanzado

| Comando                   | Descripción                                                     |
| ------------------------- | --------------------------------------------------------------- |
| `tcpdump -i eth0 port 22` | Captura paquetes en tiempo real (útil para depurar SSH o HTTP). |
| `ethtool eth0`            | Muestra velocidad, estado y estadísticas de la interfaz.        |
| `mtr google.com`          | Combina ping y traceroute mostrando latencia y pérdida.         |

**Ejemplo:**

```bash
tcpdump -nn -i eth0 host 192.168.10.10
```

Analiza tráfico detallado para diagnósticos de seguridad o rendimiento.

---

## 7.8 Configuración de Rutas Estáticas

Agregar rutas personalizadas a redes remotas.

```bash
nmcli connection modify LAN +ipv4.routes "10.0.0.0/24 192.168.10.1"
nmcli connection up LAN
```

**Ver tabla de enrutamiento:**

```bash
ip route show
```

**Explicación:**

* Define que el tráfico hacia `10.0.0.0/24` salga por el gateway `192.168.10.1`.

**Caso de uso:** interconectar subredes internas o túneles VPN.

---

## 7.9 VLANs y Puentes

### Crear VLAN ID 20 en eth0

```bash
nmcli con add type vlan con-name VLAN20 dev eth0 id 20 ipv4.addresses 192.168.20.10/24 ipv4.method manual
```

### Crear un puente (bridge)

```bash
nmcli con add type bridge con-name br0 ifname br0
nmcli con add type ethernet slave-type bridge con-name br0-port ifname eth0 master br0
```

**Usos comunes:**

* **VLANs:** segmentar redes en entornos corporativos o virtualizados.
* **Bridges:** conectar máquinas virtuales o contenedores a la red física.

---

## 7.10 Prueba Completa de Red

1. Configurar IP estática.
2. Probar conectividad local: `ping gateway`.
3. Probar salida a Internet: `ping 8.8.8.8`.
4. Verificar DNS: `dig redhat.com`.
5. Comprobar reglas del firewall: `firewall-cmd --list-all`.

**Checklist final:**

* [x] Interfaz activa (`nmcli device status`).
* [x] Gateway alcanzable.
* [x] Resolución DNS funcional.
* [x] Servicios requeridos abiertos en firewall.
* [x] Rutas estáticas confirmadas (`ip route`).

---

### Glosario

* **NetworkManager:** gestor moderno de red en RHEL.
* **Zona (firewalld):** conjunto de reglas aplicadas a una interfaz.
* **VLAN:** Virtual LAN, usada para segmentar redes.
* **Bridge:** interfaz virtual que conecta varias interfaces físicas o virtuales.
* **Ruteo estático:** configuración manual de trayectorias de red.

---

### Referencias

* Red Hat Enterprise Linux Networking Guide:
  [https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/](https://access.redhat.com/documentation/en-us/red_hat_enterprise_linux/)
* NetworkManager Reference Manual:
  [https://developer.gnome.org/NetworkManager/stable/](https://developer.gnome.org/NetworkManager/stable/)
* Firewalld Documentation: [https://firewalld.org/](https://firewalld.org/)
