# 5. Administración de Paquetes, Repositorios y Actualizaciones

La administración de paquetes es un pilar fundamental en la gestión de sistemas Linux, especialmente en distribuciones basadas en **Red Hat Enterprise Linux (RHEL)** y sus derivadas como **CentOS, AlmaLinux, Rocky Linux** y **Fedora**. Estas distribuciones utilizan el sistema **RPM** para empaquetar software y **DNF/YUM** como gestores de paquetes que automatizan la instalación, actualización, eliminación y resolución de dependencias.

---

## 5.1 RPM y DNF/YUM

### Conceptos Fundamentales

* **RPM (Red Hat Package Manager):** formato estándar de paquetes binarios para distribuciones derivadas de Red Hat. Permite instalar, verificar e inspeccionar paquetes de software.
* **DNF (Dandified YUM):** sucesor de YUM. Mejora la gestión de dependencias, la velocidad y la capacidad de rollback. Es el gestor predeterminado en RHEL 8+.
* **YUM (Yellowdog Updater, Modified):** versión previa de DNF, aún soportada por compatibilidad. Los comandos de YUM funcionan igual en DNF.

---

### Operaciones Comunes

| Acción          | Descripción                                                             | Comando                 | Ejemplo             |
| --------------- | ----------------------------------------------------------------------- | ----------------------- | ------------------- |
| Instalar        | Descarga e instala un paquete y sus dependencias.                       | `dnf install <paquete>` | `dnf install httpd` |
| Eliminar        | Desinstala un paquete y sus dependencias innecesarias.                  | `dnf remove <paquete>`  | `dnf remove httpd`  |
| Buscar          | Busca un paquete en los repositorios habilitados.                       | `dnf search <nombre>`   | `dnf search nginx`  |
| Actualizar todo | Actualiza todos los paquetes instalados a la última versión.            | `dnf upgrade`           | `dnf upgrade`       |
| Ver información | Muestra detalles del paquete (versión, fecha, dependencias, proveedor). | `rpm -qi <paquete>`     | `rpm -qi httpd`     |

---

### Ejemplo Práctico: Instalación y Verificación de Apache

```bash
dnf install httpd -y
systemctl enable --now httpd
rpm -qi httpd
dnf list installed httpd
```

**Explicación paso a paso:**

1. `dnf install httpd` descarga e instala el servidor web Apache.
2. `systemctl enable --now httpd` lo habilita al inicio y lo inicia de inmediato.
3. `rpm -qi` muestra los detalles del paquete (versión, arquitectura, fecha, firma).
4. `dnf list installed` confirma que la instalación fue exitosa.

**Caso de uso:** instalar Apache para alojar un sitio web corporativo o entorno de pruebas.

---

### Ejemplo Avanzado: Instalar un paquete local RPM

```bash
rpm -ivh /tmp/mysql-community-client-8.0.33.rpm
```

**Opciones:**

* `-i`: instala el paquete.
* `-v`: salida detallada (verbose).
* `-h`: muestra una barra de progreso.

Si existen dependencias faltantes, puede resolverse con:

```bash
dnf install /tmp/mysql-community-client-8.0.33.rpm
```

Esto asegura que DNF descargue automáticamente las dependencias requeridas desde los repositorios configurados.

---

## 5.2 Repositorios

### Definición y Ubicación

Los **repositorios** son ubicaciones (locales o remotas) que contienen paquetes `.rpm` y metadatos que DNF usa para resolver dependencias.

Los archivos de configuración de repositorios se encuentran en:

```
/etc/yum.repos.d/*.repo
```

Cada archivo `.repo` define uno o varios repositorios.

---

### Ejemplo de Configuración de Repositorio

```ini
[BaseOS]
name=BaseOS
baseurl=http://mirror.corp/BaseOS/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
```

**Parámetros principales:**

| Campo      | Descripción                                                                                  |
| ---------- | -------------------------------------------------------------------------------------------- |
| `[BaseOS]` | Identificador interno del repositorio.                                                       |
| `name`     | Nombre descriptivo.                                                                          |
| `baseurl`  | URL base donde se encuentran los paquetes (`http`, `https`, `ftp` o `file://` para locales). |
| `enabled`  | 1 = habilitado, 0 = deshabilitado.                                                           |
| `gpgcheck` | Habilita la verificación criptográfica de los paquetes.                                      |
| `gpgkey`   | Ruta a la clave pública GPG que verifica la autenticidad de los paquetes.                    |

---

### Comandos de Gestión de Repositorios

| Comando                               | Descripción                                         |
| ------------------------------------- | --------------------------------------------------- |
| `dnf repolist`                        | Muestra todos los repositorios habilitados.         |
| `dnf repolist all`                    | Lista repositorios habilitados y deshabilitados.    |
| `dnf config-manager --disable <repo>` | Deshabilita temporalmente un repo.                  |
| `dnf config-manager --add-repo <url>` | Agrega un nuevo repositorio.                        |
| `dnf makecache`                       | Regenera la caché de metadatos de los repositorios. |

**Ejemplo:**

```bash
dnf config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo
dnf install docker-ce -y
```

---

### Casos de Uso

1. **Ambientes Corporativos:** crear repositorios internos en red LAN para controlar versiones de paquetes.
2. **Sistemas Aislados:** usar repositorios locales desde DVD/ISO montados.
3. **Ambientes DevOps:** configurar repos personalizados (EPEL, Remi, Docker, Kubernetes) para dependencias específicas.

---

## 5.3 Limpieza y Mantenimiento

Con el tiempo, el gestor de paquetes acumula archivos temporales, metadatos y dependencias huérfanas. Limpiar regularmente mejora el rendimiento del sistema y libera espacio en disco.

### Comandos Clave

```bash
dnf clean all
dnf autoremove
dnf repolist
```

**Explicación:**

| Comando          | Funcionalidad                                                             |
| ---------------- | ------------------------------------------------------------------------- |
| `dnf clean all`  | Limpia toda la caché (paquetes descargados, metadatos y encabezados).     |
| `dnf autoremove` | Elimina dependencias instaladas automáticamente que ya no son necesarias. |
| `dnf repolist`   | Muestra los repositorios activos y su estado.                             |

**Ejemplo práctico de mantenimiento mensual:**

```bash
dnf clean all && dnf autoremove -y && dnf upgrade -y && dnf makecache
```

**Resultado esperado:** sistema actualizado, limpio y con repos sincronizados.

---

### Buenas Prácticas

* Ejecutar `dnf upgrade` semanalmente en entornos productivos.
* Mantener una copia local del repositorio para contingencias sin conexión.
* Revisar dependencias rotas con `dnf repoquery --unsatisfied`.
* Documentar repositorios externos para auditorías.

---

### Errores Comunes y Soluciones

| Problema                      | Causa                                  | Solución                                                |
| ----------------------------- | -------------------------------------- | ------------------------------------------------------- |
| `Failed to download metadata` | URL de repositorio incorrecta o caída. | Revisar `baseurl` o deshabilitar temporalmente el repo. |
| `GPG key not found`           | Clave pública ausente o no instalada.  | Importar con `rpm --import /ruta/clave.gpg`.            |
| `Cannot find a valid baseurl` | Falla de red o proxy.                  | Verificar conectividad o proxy en `/etc/dnf/dnf.conf`.  |

---

### Glosario

* **Dependencia:** paquete requerido por otro para funcionar.
* **Repositorio:** fuente de paquetes (local o remota).
* **GPG Key:** firma criptográfica que garantiza la autenticidad.
* **Caché DNF:** metadatos y paquetes descargados temporalmente.
* **Rollback:** capacidad de revertir una instalación fallida.

---

### Referencias

* Red Hat Documentation: [https://access.redhat.com/documentation/en-us/](https://access.redhat.com/documentation/en-us/)
* DNF Command Reference: [https://dnf.readthedocs.io/](https://dnf.readthedocs.io/)
* Fedora Project Wiki: [https://fedoraproject.org/wiki/DNF](https://fedoraproject.org/wiki/DNF)
